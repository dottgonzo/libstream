"use strict";
var express_1 = require("express");
var router = express_1.Router();
function codeStream(data) {
    if (!data) {
        throw "no data";
    }
    else if (!data.channel) {
        throw "no channel";
    }
    else if (!data.hostname) {
        throw "no host data";
    }
    var mediapp = "live";
    var hlsapp = "hls";
    if (data.app)
        mediapp = data.app;
    if (data.hlsapp)
        hlsapp = data.hlsapp;
    var code;
    if (!data.format)
        data.format = "mobile";
    if (data.format.toUpperCase() === 'DESKTOP')
        data.format = "desktop";
    if (!data.width) {
        data.width = 862;
        data.height = 465;
    }
    else if (!data.height) {
        data.height = (1080 * data.width) / 1920;
    }
    switch (data.format) {
        case "desktop":
            if (!data.rtmp_port)
                data.rtmp_port = 1935;
            var flashplayer = "https://play.kernel.online/lib/StrobeMediaPlayback.swf";
            if (data.flashplayer)
                flashplayer = data.flashplayer;
            if (!data.isTime || data.isTime === "now") {
                code = '<object width="' + data.width + '" height="' + data.height + '"> <param name="movie" value=' + flashplayer + '></param><param name="flashvars" value="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src=' + flashplayer + ' type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="' + data.width + '" height="' + data.height + '" flashvars="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></embed></object>';
            }
            else if (data.isTime === "past") {
                code = '<object width="' + data.width + '" height="' + data.height + '"> <param name="movie" value="' + flashplayer + '"></param><param name="flashvars" value="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="' + flashplayer + '" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="' + data.width + '" height="' + data.height + '" flashvars="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></embed></object>';
            }
            else if (data.isTime === "future") {
                code = '<object width="' + data.width + '" height="' + data.height + '"> <param name="movie" value="' + flashplayer + '"></param><param name="flashvars" value="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="' + flashplayer + '" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="' + data.width + '" height="' + data.height + '" flashvars="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></embed></object>';
            }
            break;
        default:
            if (!data.protocol)
                data.protocol = "http";
            if (!data.http_port)
                data.http_port = 80;
            if (!data.img) {
                data.img = 'https://lh6.ggpht.com/NrQdFAdPSI9-hreB4C7HNhj3yXRiW1jqOOi7eFyakIx_IA-Im0huIeYCs5jTidMT2qA=w300';
            }
            if (!data.isTime || data.isTime === "now") {
                code = '<div style="width:' + data.width + 'px;height:' + data.height + 'px;text-align:center;"><a style="background-color: whitesmoke;width:' + data.width + 'px;height:' + data.height + 'px;display:block;" href="http://' + data.hostname + ":" + data.http_port + '/' + hlsapp + '/' + data.channel + '.m3u8"><img style="max-width:120px;margin-top:' + ((data.height - 120) / 2) + 'px" src="' + data.img + '"></a></div>';
            }
            else if (data.isTime === "past") {
                code = '<div style="width:' + data.width + 'px;height:' + data.height + 'px;text-align:center;"><a style="background-color: whitesmoke;width:' + data.width + 'px;height:' + data.height + 'px;display:block;" href="http://' + data.hostname + ":" + data.http_port + '/' + hlsapp + '/' + data.channel + '.m3u8"><img style="max-width:120px;margin-top:' + ((data.height - 120) / 2) + 'px" src="' + data.img + '"></a></div>';
            }
            else if (data.isTime === "future") {
                code = '<div style="width:' + data.width + 'px;height:' + data.height + 'px;text-align:center;"><a style="background-color: whitesmoke;width:' + data.width + 'px;height:' + data.height + 'px;display:block;" href="http://' + data.hostname + ":" + data.http_port + '/' + hlsapp + '/' + data.channel + '.m3u8"><img style="max-width:120px;margin-top:' + ((data.height - 120) / 2) + 'px" src="' + data.img + '"></a></div>';
            }
            break;
    }
    return code;
}
exports.codeStream = codeStream;
function codeToHtml(code) {
    return '<!DOCTYPE html><html><meta charset="utf-8"><head><style>body{margin:0px;padding:0px;overflow:hidden}</style></head><body>' + code + '</body></html>';
}
exports.codeToHtml = codeToHtml;
function HtmlPage(data) {
    return codeToHtml(codeStream(data));
}
exports.HtmlPage = HtmlPage;
router.get('/flashplayer', function (req, res) {
    res.sendFile(__dirname + "/bin/StrobeMediaPlayback.swf");
});
router.get('/', function (req, res) {
    console.log("Hi to " + req.device.type + " User");
    if (req.query.channel) {
        if (req.device && req.device.type && !req.query.format) {
            req.query.format = req.device.type;
        }
        if (!req.query.flashplayer && process.env.SERVERHOST) {
            req.query.flashplayer = process.env.SERVERHOST + "/flashplayer";
        }
        if (req.query.hostname) {
            res.send(HtmlPage(req.query));
        }
        else if (process.env.STREAMERHOST) {
            req.query.hostname = process.env.STREAMERHOST;
            if (!req.query.rtmp_port && process.env.STREAMER_RTMP_PORT)
                req.query.rtmp_port = process.env.STREAMER_RTMP_PORT;
            if (!req.query.http_port && process.env.STREAMER_HTTP_PORT)
                req.query.http_port = process.env.STREAMER_HTTP_PORT;
            if (!req.query.protocol && process.env.STREAMER_HTTP_PROTOCOL)
                req.query.protocol = process.env.STREAMER_HTTP_PROTOCOL;
            res.send(HtmlPage(req.query));
        }
        else {
            res.send({ error: "no host provided" });
        }
    }
    else {
        res.send({ error: "no channel provided" });
    }
});
exports.htmlpage = router;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUdKLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDO1FBRTVDLENBQUM7SUFJTCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFHSixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLHFCQUFxQixFQUFFLENBQUMsQ0FBQztJQUUvQyxDQUFDO0FBR0wsQ0FBQyxDQUFDLENBQUM7QUFFVSxRQUFBLFFBQVEsR0FBRyxNQUFNLENBQUEiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSb3V0ZXIgfSBmcm9tIFwiZXhwcmVzc1wiXG5cbmNvbnN0IHJvdXRlciA9IFJvdXRlcigpXG5cblxuZXhwb3J0IHR5cGUgSXNUaW1ldG9TdHJlYW0gPSBcIm5vd1wiIHwgXCJwYXN0XCIgfCBcImZ1dHVyZVwiXG5cbmV4cG9ydCBpbnRlcmZhY2UgSWNvZGVTdHJlYW0ge1xuICAgIGZvcm1hdD86IHN0cmluZztcbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICBoZWlnaHQ/OiBudW1iZXI7XG4gICAgaG9zdG5hbWU/OiBzdHJpbmc7XG4gICAgaHR0cF9wb3J0PzogbnVtYmVyO1xuICAgIGNoYW5uZWw6IHN0cmluZztcbiAgICBpbWc/OiBzdHJpbmc7XG4gICAgcnRtcF9wb3J0PzogbnVtYmVyO1xuICAgIHByb3RvY29sPzogc3RyaW5nO1xuICAgIGlzVGltZT86IElzVGltZXRvU3RyZWFtXG4gICAgZmxhc2hwbGF5ZXI/OiBzdHJpbmdcbiAgICBhcHA/OiBzdHJpbmdcbiAgICBobHNhcHA/OiBzdHJpbmdcbiAgICBhdXRvcGxheT86IHRydWUgLy90b2RvXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNvZGVTdHJlYW0oZGF0YTogSWNvZGVTdHJlYW0pIHtcblxuICAgIGlmICghZGF0YSkge1xuICAgICAgICB0aHJvdyBcIm5vIGRhdGFcIjtcbiAgICB9IGVsc2UgaWYgKCFkYXRhLmNoYW5uZWwpIHtcbiAgICAgICAgdGhyb3cgXCJubyBjaGFubmVsXCI7XG4gICAgfSBlbHNlIGlmICghZGF0YS5ob3N0bmFtZSkge1xuICAgICAgICB0aHJvdyBcIm5vIGhvc3QgZGF0YVwiO1xuICAgIH1cblxuICAgIGxldCBtZWRpYXBwID0gXCJsaXZlXCJcbiAgICBsZXQgaGxzYXBwID0gXCJobHNcIlxuXG5cbiAgICBpZiAoZGF0YS5hcHApIG1lZGlhcHAgPSBkYXRhLmFwcFxuICAgIGlmIChkYXRhLmhsc2FwcCkgaGxzYXBwID0gZGF0YS5obHNhcHBcblxuXG4gICAgbGV0IGNvZGU7XG5cbiAgICBpZiAoIWRhdGEuZm9ybWF0KSBkYXRhLmZvcm1hdCA9IFwibW9iaWxlXCI7XG4gICAgaWYgKGRhdGEuZm9ybWF0LnRvVXBwZXJDYXNlKCkgPT09ICdERVNLVE9QJykgZGF0YS5mb3JtYXQgPSBcImRlc2t0b3BcIjtcblxuXG5cbiAgICBpZiAoIWRhdGEud2lkdGgpIHtcblxuICAgICAgICBkYXRhLndpZHRoID0gODYyO1xuICAgICAgICBkYXRhLmhlaWdodCA9IDQ2NTtcblxuICAgIH0gZWxzZSBpZiAoIWRhdGEuaGVpZ2h0KSB7XG4gICAgICAgIGRhdGEuaGVpZ2h0ID0gKDEwODAgKiBkYXRhLndpZHRoKSAvIDE5MjA7XG4gICAgfVxuXG5cblxuICAgIHN3aXRjaCAoZGF0YS5mb3JtYXQpIHtcblxuICAgICAgICBjYXNlIFwiZGVza3RvcFwiOlxuXG4gICAgICAgICAgICBpZiAoIWRhdGEucnRtcF9wb3J0KSBkYXRhLnJ0bXBfcG9ydCA9IDE5MzU7XG5cbiAgICAgICAgICAgIGxldCBmbGFzaHBsYXllciA9IFwiaHR0cHM6Ly9wbGF5Lmtlcm5lbC5vbmxpbmUvbGliL1N0cm9iZU1lZGlhUGxheWJhY2suc3dmXCJcbiAgICAgICAgICAgIGlmIChkYXRhLmZsYXNocGxheWVyKSBmbGFzaHBsYXllciA9IGRhdGEuZmxhc2hwbGF5ZXJcblxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuaXNUaW1lIHx8IGRhdGEuaXNUaW1lID09PSBcIm5vd1wiKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9ICc8b2JqZWN0IHdpZHRoPVwiJyArIGRhdGEud2lkdGggKyAnXCIgaGVpZ2h0PVwiJyArIGRhdGEuaGVpZ2h0ICsgJ1wiPiA8cGFyYW0gbmFtZT1cIm1vdmllXCIgdmFsdWU9JyArIGZsYXNocGxheWVyICsgJz48L3BhcmFtPjxwYXJhbSBuYW1lPVwiZmxhc2h2YXJzXCIgdmFsdWU9XCJzcmM9cnRtcCUzQSUyRiUyRicgKyBkYXRhLmhvc3RuYW1lICsgJyUzQScgKyBkYXRhLnJ0bXBfcG9ydCArICclMkYnICsgbWVkaWFwcCArICclMkYnICsgZGF0YS5jaGFubmVsICsgJyZzdHJlYW1UeXBlPWxpdmUmc2NhbGVNb2RlPXpvb21cIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwiYWxsb3dGdWxsU2NyZWVuXCIgdmFsdWU9XCJ0cnVlXCI+PC9wYXJhbT48cGFyYW0gbmFtZT1cImFsbG93c2NyaXB0YWNjZXNzXCIgdmFsdWU9XCJhbHdheXNcIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwid21vZGVcIiB2YWx1ZT1cImRpcmVjdFwiPjwvcGFyYW0+PGVtYmVkIHNyYz0nICsgZmxhc2hwbGF5ZXIgKyAnIHR5cGU9XCJhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaFwiIGFsbG93c2NyaXB0YWNjZXNzPVwiYWx3YXlzXCIgYWxsb3dmdWxsc2NyZWVuPVwidHJ1ZVwiIHdtb2RlPVwiZGlyZWN0XCIgd2lkdGg9XCInICsgZGF0YS53aWR0aCArICdcIiBoZWlnaHQ9XCInICsgZGF0YS5oZWlnaHQgKyAnXCIgZmxhc2h2YXJzPVwic3JjPXJ0bXAlM0ElMkYlMkYnICsgZGF0YS5ob3N0bmFtZSArICclM0EnICsgZGF0YS5ydG1wX3BvcnQgKyAnJTJGJyArIG1lZGlhcHAgKyAnJTJGJyArIGRhdGEuY2hhbm5lbCArICcmc3RyZWFtVHlwZT1saXZlJnNjYWxlTW9kZT16b29tXCI+PC9lbWJlZD48L29iamVjdD4nXG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pc1RpbWUgPT09IFwicGFzdFwiKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9ICc8b2JqZWN0IHdpZHRoPVwiJyArIGRhdGEud2lkdGggKyAnXCIgaGVpZ2h0PVwiJyArIGRhdGEuaGVpZ2h0ICsgJ1wiPiA8cGFyYW0gbmFtZT1cIm1vdmllXCIgdmFsdWU9XCInICsgZmxhc2hwbGF5ZXIgKyAnXCI+PC9wYXJhbT48cGFyYW0gbmFtZT1cImZsYXNodmFyc1wiIHZhbHVlPVwic3JjPXJ0bXAlM0ElMkYlMkYnICsgZGF0YS5ob3N0bmFtZSArICclM0EnICsgZGF0YS5ydG1wX3BvcnQgKyAnJTJGJyArIG1lZGlhcHAgKyAnJTJGJyArIGRhdGEuY2hhbm5lbCArICcmc3RyZWFtVHlwZT1saXZlJnNjYWxlTW9kZT16b29tXCI+PC9wYXJhbT48cGFyYW0gbmFtZT1cImFsbG93RnVsbFNjcmVlblwiIHZhbHVlPVwidHJ1ZVwiPjwvcGFyYW0+PHBhcmFtIG5hbWU9XCJhbGxvd3NjcmlwdGFjY2Vzc1wiIHZhbHVlPVwiYWx3YXlzXCI+PC9wYXJhbT48cGFyYW0gbmFtZT1cIndtb2RlXCIgdmFsdWU9XCJkaXJlY3RcIj48L3BhcmFtPjxlbWJlZCBzcmM9XCInICsgZmxhc2hwbGF5ZXIgKyAnXCIgdHlwZT1cImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoXCIgYWxsb3dzY3JpcHRhY2Nlc3M9XCJhbHdheXNcIiBhbGxvd2Z1bGxzY3JlZW49XCJ0cnVlXCIgd21vZGU9XCJkaXJlY3RcIiB3aWR0aD1cIicgKyBkYXRhLndpZHRoICsgJ1wiIGhlaWdodD1cIicgKyBkYXRhLmhlaWdodCArICdcIiBmbGFzaHZhcnM9XCJzcmM9cnRtcCUzQSUyRiUyRicgKyBkYXRhLmhvc3RuYW1lICsgJyUzQScgKyBkYXRhLnJ0bXBfcG9ydCArICclMkYnICsgbWVkaWFwcCArICclMkYnICsgZGF0YS5jaGFubmVsICsgJyZzdHJlYW1UeXBlPWxpdmUmc2NhbGVNb2RlPXpvb21cIj48L2VtYmVkPjwvb2JqZWN0PidcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pc1RpbWUgPT09IFwiZnV0dXJlXCIpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gJzxvYmplY3Qgd2lkdGg9XCInICsgZGF0YS53aWR0aCArICdcIiBoZWlnaHQ9XCInICsgZGF0YS5oZWlnaHQgKyAnXCI+IDxwYXJhbSBuYW1lPVwibW92aWVcIiB2YWx1ZT1cIicgKyBmbGFzaHBsYXllciArICdcIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwiZmxhc2h2YXJzXCIgdmFsdWU9XCJzcmM9cnRtcCUzQSUyRiUyRicgKyBkYXRhLmhvc3RuYW1lICsgJyUzQScgKyBkYXRhLnJ0bXBfcG9ydCArICclMkYnICsgbWVkaWFwcCArICclMkYnICsgZGF0YS5jaGFubmVsICsgJyZzdHJlYW1UeXBlPWxpdmUmc2NhbGVNb2RlPXpvb21cIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwiYWxsb3dGdWxsU2NyZWVuXCIgdmFsdWU9XCJ0cnVlXCI+PC9wYXJhbT48cGFyYW0gbmFtZT1cImFsbG93c2NyaXB0YWNjZXNzXCIgdmFsdWU9XCJhbHdheXNcIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwid21vZGVcIiB2YWx1ZT1cImRpcmVjdFwiPjwvcGFyYW0+PGVtYmVkIHNyYz1cIicgKyBmbGFzaHBsYXllciArICdcIiB0eXBlPVwiYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2hcIiBhbGxvd3NjcmlwdGFjY2Vzcz1cImFsd2F5c1wiIGFsbG93ZnVsbHNjcmVlbj1cInRydWVcIiB3bW9kZT1cImRpcmVjdFwiIHdpZHRoPVwiJyArIGRhdGEud2lkdGggKyAnXCIgaGVpZ2h0PVwiJyArIGRhdGEuaGVpZ2h0ICsgJ1wiIGZsYXNodmFycz1cInNyYz1ydG1wJTNBJTJGJTJGJyArIGRhdGEuaG9zdG5hbWUgKyAnJTNBJyArIGRhdGEucnRtcF9wb3J0ICsgJyUyRicgKyBtZWRpYXBwICsgJyUyRicgKyBkYXRhLmNoYW5uZWwgKyAnJnN0cmVhbVR5cGU9bGl2ZSZzY2FsZU1vZGU9em9vbVwiPjwvZW1iZWQ+PC9vYmplY3Q+J1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG5cbiAgICAgICAgZGVmYXVsdDpcblxuXG5cbiAgICAgICAgICAgIGlmICghZGF0YS5wcm90b2NvbCkgZGF0YS5wcm90b2NvbCA9IFwiaHR0cFwiO1xuXG4gICAgICAgICAgICBpZiAoIWRhdGEuaHR0cF9wb3J0KSBkYXRhLmh0dHBfcG9ydCA9IDgwO1xuXG5cbiAgICAgICAgICAgIGlmICghZGF0YS5pbWcpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmltZyA9ICdodHRwczovL2xoNi5nZ3BodC5jb20vTnJRZEZBZFBTSTktaHJlQjRDN0hOaGozeVhSaVcxanFPT2k3ZUZ5YWtJeF9JQS1JbTBodUllWUNzNWpUaWRNVDJxQT13MzAwJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFkYXRhLmlzVGltZSB8fCBkYXRhLmlzVGltZSA9PT0gXCJub3dcIikge1xuICAgICAgICAgICAgICAgIGNvZGUgPSAnPGRpdiBzdHlsZT1cIndpZHRoOicgKyBkYXRhLndpZHRoICsgJ3B4O2hlaWdodDonICsgZGF0YS5oZWlnaHQgKyAncHg7dGV4dC1hbGlnbjpjZW50ZXI7XCI+PGEgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZXNtb2tlO3dpZHRoOicgKyBkYXRhLndpZHRoICsgJ3B4O2hlaWdodDonICsgZGF0YS5oZWlnaHQgKyAncHg7ZGlzcGxheTpibG9jaztcIiBocmVmPVwiaHR0cDovLycgKyBkYXRhLmhvc3RuYW1lICsgXCI6XCIgKyBkYXRhLmh0dHBfcG9ydCArICcvJyArIGhsc2FwcCArICcvJyArIGRhdGEuY2hhbm5lbCArICcubTN1OFwiPjxpbWcgc3R5bGU9XCJtYXgtd2lkdGg6MTIwcHg7bWFyZ2luLXRvcDonKygoZGF0YS5oZWlnaHQtMTIwKS8yKSsncHhcIiBzcmM9XCInICsgZGF0YS5pbWcgKyAnXCI+PC9hPjwvZGl2Pic7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pc1RpbWUgPT09IFwicGFzdFwiKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9ICc8ZGl2IHN0eWxlPVwid2lkdGg6JyArIGRhdGEud2lkdGggKyAncHg7aGVpZ2h0OicgKyBkYXRhLmhlaWdodCArICdweDt0ZXh0LWFsaWduOmNlbnRlcjtcIj48YSBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6IHdoaXRlc21va2U7d2lkdGg6JyArIGRhdGEud2lkdGggKyAncHg7aGVpZ2h0OicgKyBkYXRhLmhlaWdodCArICdweDtkaXNwbGF5OmJsb2NrO1wiIGhyZWY9XCJodHRwOi8vJyArIGRhdGEuaG9zdG5hbWUgKyBcIjpcIiArIGRhdGEuaHR0cF9wb3J0ICsgJy8nICsgaGxzYXBwICsgJy8nICsgZGF0YS5jaGFubmVsICsgJy5tM3U4XCI+PGltZyBzdHlsZT1cIm1heC13aWR0aDoxMjBweDttYXJnaW4tdG9wOicrKChkYXRhLmhlaWdodC0xMjApLzIpKydweFwiIHNyYz1cIicgKyBkYXRhLmltZyArICdcIj48L2E+PC9kaXY+JztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5pc1RpbWUgPT09IFwiZnV0dXJlXCIpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gJzxkaXYgc3R5bGU9XCJ3aWR0aDonICsgZGF0YS53aWR0aCArICdweDtoZWlnaHQ6JyArIGRhdGEuaGVpZ2h0ICsgJ3B4O3RleHQtYWxpZ246Y2VudGVyO1wiPjxhIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogd2hpdGVzbW9rZTt3aWR0aDonICsgZGF0YS53aWR0aCArICdweDtoZWlnaHQ6JyArIGRhdGEuaGVpZ2h0ICsgJ3B4O2Rpc3BsYXk6YmxvY2s7XCIgaHJlZj1cImh0dHA6Ly8nICsgZGF0YS5ob3N0bmFtZSArIFwiOlwiICsgZGF0YS5odHRwX3BvcnQgKyAnLycgKyBobHNhcHAgKyAnLycgKyBkYXRhLmNoYW5uZWwgKyAnLm0zdThcIj48aW1nIHN0eWxlPVwibWF4LXdpZHRoOjEyMHB4O21hcmdpbi10b3A6JysoKGRhdGEuaGVpZ2h0LTEyMCkvMikrJ3B4XCIgc3JjPVwiJyArIGRhdGEuaW1nICsgJ1wiPjwvYT48L2Rpdj4nO1xuXG4gICAgICAgICAgICB9XG5cblxuXG5cblxuICAgICAgICAgICAgYnJlYWs7XG5cblxuICAgIH1cblxuXG4gICAgcmV0dXJuIGNvZGU7XG5cblxuXG5cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gY29kZVRvSHRtbChjb2RlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gJzwhRE9DVFlQRSBodG1sPjxodG1sPjxtZXRhIGNoYXJzZXQ9XCJ1dGYtOFwiPjxoZWFkPjxzdHlsZT5ib2R5e21hcmdpbjowcHg7cGFkZGluZzowcHg7b3ZlcmZsb3c6aGlkZGVufTwvc3R5bGU+PC9oZWFkPjxib2R5PicgKyBjb2RlICsgJzwvYm9keT48L2h0bWw+J1xufVxuXG5leHBvcnQgZnVuY3Rpb24gSHRtbFBhZ2UoZGF0YTogSWNvZGVTdHJlYW0pIHtcbiAgICByZXR1cm4gY29kZVRvSHRtbChjb2RlU3RyZWFtKGRhdGEpKVxufVxuXG5yb3V0ZXIuZ2V0KCcvZmxhc2hwbGF5ZXInLCBmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgICByZXMuc2VuZEZpbGUoX19kaXJuYW1lICsgXCIvYmluL1N0cm9iZU1lZGlhUGxheWJhY2suc3dmXCIpXG59KTtcblxuXG4vLyBkZWZpbmUgdGhlIGhvbWUgcGFnZSByb3V0ZVxucm91dGVyLmdldCgnLycsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuXG4gICAgY29uc29sZS5sb2coXCJIaSB0byBcIiArIHJlcS5kZXZpY2UudHlwZSArIFwiIFVzZXJcIik7XG5cblxuXG5cbiAgICBpZiAocmVxLnF1ZXJ5LmNoYW5uZWwpIHtcblxuXG4gICAgICAgIGlmIChyZXEuZGV2aWNlICYmIHJlcS5kZXZpY2UudHlwZSYmICFyZXEucXVlcnkuZm9ybWF0KSB7XG4gICAgICAgICAgICByZXEucXVlcnkuZm9ybWF0ID0gcmVxLmRldmljZS50eXBlXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXJlcS5xdWVyeS5mbGFzaHBsYXllciAmJiBwcm9jZXNzLmVudi5TRVJWRVJIT1NUKSB7XG5cblxuICAgICAgICAgICAgcmVxLnF1ZXJ5LmZsYXNocGxheWVyID0gcHJvY2Vzcy5lbnYuU0VSVkVSSE9TVCArIFwiL2ZsYXNocGxheWVyXCJcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXEucXVlcnkuaG9zdG5hbWUpIHtcblxuXG4gICAgICAgICAgICByZXMuc2VuZChIdG1sUGFnZShyZXEucXVlcnkpKTtcbiAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzLmVudi5TVFJFQU1FUkhPU1QpIHtcblxuICAgICAgICAgICAgcmVxLnF1ZXJ5Lmhvc3RuYW1lID0gcHJvY2Vzcy5lbnYuU1RSRUFNRVJIT1NUXG5cbiAgICAgICAgICAgIGlmICghcmVxLnF1ZXJ5LnJ0bXBfcG9ydCAmJiBwcm9jZXNzLmVudi5TVFJFQU1FUl9SVE1QX1BPUlQpIHJlcS5xdWVyeS5ydG1wX3BvcnQgPSBwcm9jZXNzLmVudi5TVFJFQU1FUl9SVE1QX1BPUlRcbiAgICAgICAgICAgIGlmICghcmVxLnF1ZXJ5Lmh0dHBfcG9ydCAmJiBwcm9jZXNzLmVudi5TVFJFQU1FUl9IVFRQX1BPUlQpIHJlcS5xdWVyeS5odHRwX3BvcnQgPSBwcm9jZXNzLmVudi5TVFJFQU1FUl9IVFRQX1BPUlRcbiAgICAgICAgICAgIGlmICghcmVxLnF1ZXJ5LnByb3RvY29sICYmIHByb2Nlc3MuZW52LlNUUkVBTUVSX0hUVFBfUFJPVE9DT0wpIHJlcS5xdWVyeS5wcm90b2NvbCA9IHByb2Nlc3MuZW52LlNUUkVBTUVSX0hUVFBfUFJPVE9DT0xcblxuICAgICAgICAgICAgcmVzLnNlbmQoSHRtbFBhZ2UocmVxLnF1ZXJ5KSk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuXG4gICAgICAgICAgICByZXMuc2VuZCh7IGVycm9yOiBcIm5vIGhvc3QgcHJvdmlkZWRcIiB9KTtcblxuICAgICAgICB9XG5cblxuXG4gICAgfSBlbHNlIHtcblxuXG4gICAgICAgIHJlcy5zZW5kKHsgZXJyb3I6IFwibm8gY2hhbm5lbCBwcm92aWRlZFwiIH0pO1xuXG4gICAgfVxuXG5cbn0pO1xuXG5leHBvcnQgY29uc3QgaHRtbHBhZ2UgPSByb3V0ZXIiXX0=
