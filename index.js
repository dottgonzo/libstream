"use strict";
var express_1 = require("express");
var router = express_1.Router();
function codeStream(data) {
    if (!data) {
        throw "no data";
    }
    else if (!data.channel) {
        throw "no channel";
    }
    else if (!data.hostname) {
        throw "no host data";
    }
    var mediapp = "live";
    var hlsapp = "hls";
    if (data.app)
        mediapp = data.app;
    if (data.hlsapp)
        hlsapp = data.hlsapp;
    var code;
    if (!data.format)
        data.format = "desktop";
    if (!data.width) {
        data.width = 862;
        data.height = 465;
    }
    else if (!data.height) {
        data.height = (1080 * data.width) / 1920;
    }
    switch (data.format) {
        case "mobile":
            if (!data.protocol)
                data.protocol = "http";
            if (!data.http_port)
                data.http_port = 80;
            if (!data.img) {
                data.img = 'https://lh6.ggpht.com/NrQdFAdPSI9-hreB4C7HNhj3yXRiW1jqOOi7eFyakIx_IA-Im0huIeYCs5jTidMT2qA=w300';
            }
            if (!data.isTime || data.isTime === "now") {
                code = '<div style="width:' + data.width + ';height:' + data.height + ';text-align:center;"><a href="http://' + data.hostname + ":" + data.http_port + '/' + hlsapp + '/' + data.channel + '.m3u8"><img style="max-width:120px" src="' + data.img + '"></a></div>';
            }
            else if (data.isTime === "past") {
                code = '<div style="width:' + data.width + ';height:' + data.height + ';text-align:center;"><a href="http://' + data.hostname + ":" + data.http_port + '/' + hlsapp + '/' + data.channel + '.m3u8"><img style="max-width:120px" src="' + data.img + '"></a></div>';
            }
            else if (data.isTime === "future") {
                code = '<div style="width:' + data.width + ';height:' + data.height + ';text-align:center;"><a href="http://' + data.hostname + ":" + data.http_port + '/' + hlsapp + '/' + data.channel + '.m3u8"><img style="max-width:120px" src="' + data.img + '"></a></div>';
            }
            break;
        default:
            if (!data.rtmp_port)
                data.rtmp_port = 1935;
            var flashplayer = "https://play.kernel.online/lib/StrobeMediaPlayback.swf";
            if (data.flashplayer)
                flashplayer = data.flashplayer;
            if (!data.isTime || data.isTime === "now") {
                code = '<object width="' + data.width + '" height="' + data.height + '"> <param name="movie" value=' + flashplayer + '></param><param name="flashvars" value="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src=' + flashplayer + ' type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="' + data.width + '" height="' + data.height + '" flashvars="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></embed></object>';
            }
            else if (data.isTime === "past") {
                code = '<object width="' + data.width + '" height="' + data.height + '"> <param name="movie" value="' + flashplayer + '"></param><param name="flashvars" value="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="' + flashplayer + '" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="' + data.width + '" height="' + data.height + '" flashvars="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></embed></object>';
            }
            else if (data.isTime === "future") {
                code = '<object width="' + data.width + '" height="' + data.height + '"> <param name="movie" value="' + flashplayer + '"></param><param name="flashvars" value="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><param name="wmode" value="direct"></param><embed src="' + flashplayer + '" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" wmode="direct" width="' + data.width + '" height="' + data.height + '" flashvars="src=rtmp%3A%2F%2F' + data.hostname + '%3A' + data.rtmp_port + '%2F' + mediapp + '%2F' + data.channel + '&streamType=live&scaleMode=zoom"></embed></object>';
            }
            break;
    }
    return code;
}
exports.codeStream = codeStream;
function codeToHtml(code) {
    return '<!DOCTYPE html><html><meta charset="utf-8"><head><style>body{margin:0px;padding:0px;overflow:hidden}</style></head><body>' + code + '</body></html>';
}
exports.codeToHtml = codeToHtml;
function HtmlPage(data) {
    return codeToHtml(codeStream(data));
}
exports.HtmlPage = HtmlPage;
router.get('/flashplayer', function (req, res) {
    res.sendFile(__dirname + "/bin/StrobeMediaPlayback.swf");
});
router.get('/', function (req, res) {
    if (req.query.channel) {
        if (!req.query.flashplayer && process.env.SERVERHOST) {
            req.query.flashplayer = process.env.SERVERHOST + "/flashplayer";
        }
        if (req.query.hostname) {
            res.send(HtmlPage(req.query));
        }
        else if (process.env.STREAMERHOST) {
            req.query.hostname = process.env.STREAMERHOST;
            if (!req.query.rtmp_port && process.env.STREAMER_RTMP_PORT)
                req.query.rtmp_port = process.env.STREAMER_RTMP_PORT;
            if (!req.query.http_port && process.env.STREAMER_HTTP_PORT)
                req.query.http_port = process.env.STREAMER_HTTP_PORT;
            if (!req.query.protocol && process.env.STREAMER_HTTP_PROTOCOL)
                req.query.protocol = process.env.STREAMER_HTTP_PROTOCOL;
            res.send(HtmlPage(req.query));
        }
        else {
            res.send({ error: "no host provided" });
        }
    }
    else {
        res.send({ error: "no channel provided" });
    }
});
exports.htmlpage = router;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RyxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsQ0FBQTtZQUV0SCxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUVsQyxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFHSixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztRQUU1QyxDQUFDO0lBSUwsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBR0osR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxxQkFBcUIsRUFBRSxDQUFDLENBQUM7SUFFL0MsQ0FBQztBQUdMLENBQUMsQ0FBQyxDQUFDO0FBRVUsUUFBQSxRQUFRLEdBQUcsTUFBTSxDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUm91dGVyIH0gZnJvbSBcImV4cHJlc3NcIlxuXG5jb25zdCByb3V0ZXIgPSBSb3V0ZXIoKVxuXG5cbmV4cG9ydCB0eXBlIElzVGltZXRvU3RyZWFtID0gXCJub3dcIiB8IFwicGFzdFwiIHwgXCJmdXR1cmVcIlxuXG5leHBvcnQgaW50ZXJmYWNlIEljb2RlU3RyZWFtIHtcbiAgICBmb3JtYXQ/OiBzdHJpbmc7XG4gICAgd2lkdGg/OiBudW1iZXI7XG4gICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgIGhvc3RuYW1lPzogc3RyaW5nO1xuICAgIGh0dHBfcG9ydD86IG51bWJlcjtcbiAgICBjaGFubmVsOiBzdHJpbmc7XG4gICAgaW1nPzogc3RyaW5nO1xuICAgIHJ0bXBfcG9ydD86IG51bWJlcjtcbiAgICBwcm90b2NvbD86IHN0cmluZztcbiAgICBpc1RpbWU/OiBJc1RpbWV0b1N0cmVhbVxuICAgIGZsYXNocGxheWVyPzogc3RyaW5nXG4gICAgYXBwPzogc3RyaW5nXG4gICAgaGxzYXBwPzogc3RyaW5nXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNvZGVTdHJlYW0oZGF0YTogSWNvZGVTdHJlYW0pIHtcblxuICAgIGlmICghZGF0YSkge1xuICAgICAgICB0aHJvdyBcIm5vIGRhdGFcIjtcbiAgICB9IGVsc2UgaWYgKCFkYXRhLmNoYW5uZWwpIHtcbiAgICAgICAgdGhyb3cgXCJubyBjaGFubmVsXCI7XG4gICAgfSBlbHNlIGlmICghZGF0YS5ob3N0bmFtZSkge1xuICAgICAgICB0aHJvdyBcIm5vIGhvc3QgZGF0YVwiO1xuICAgIH1cblxuICAgIGxldCBtZWRpYXBwID0gXCJsaXZlXCJcbiAgICBsZXQgaGxzYXBwID0gXCJobHNcIlxuXG5cbiAgICBpZiAoZGF0YS5hcHApIG1lZGlhcHAgPSBkYXRhLmFwcFxuICAgIGlmIChkYXRhLmhsc2FwcCkgaGxzYXBwID0gZGF0YS5obHNhcHBcblxuXG4gICAgbGV0IGNvZGU7XG5cbiAgICBpZiAoIWRhdGEuZm9ybWF0KSBkYXRhLmZvcm1hdCA9IFwiZGVza3RvcFwiO1xuXG5cblxuICAgIGlmICghZGF0YS53aWR0aCkge1xuXG4gICAgICAgIGRhdGEud2lkdGggPSA4NjI7XG4gICAgICAgIGRhdGEuaGVpZ2h0ID0gNDY1O1xuXG4gICAgfSBlbHNlIGlmICghZGF0YS5oZWlnaHQpIHtcbiAgICAgICAgZGF0YS5oZWlnaHQgPSAoMTA4MCAqIGRhdGEud2lkdGgpIC8gMTkyMDtcbiAgICB9XG5cblxuXG4gICAgc3dpdGNoIChkYXRhLmZvcm1hdCkge1xuXG4gICAgICAgIGNhc2UgXCJtb2JpbGVcIjpcblxuICAgICAgICAgICAgaWYgKCFkYXRhLnByb3RvY29sKSBkYXRhLnByb3RvY29sID0gXCJodHRwXCI7XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5odHRwX3BvcnQpIGRhdGEuaHR0cF9wb3J0ID0gODA7XG5cblxuICAgICAgICAgICAgaWYgKCFkYXRhLmltZykge1xuICAgICAgICAgICAgICAgIGRhdGEuaW1nID0gJ2h0dHBzOi8vbGg2LmdncGh0LmNvbS9OclFkRkFkUFNJOS1ocmVCNEM3SE5oajN5WFJpVzFqcU9PaTdlRnlha0l4X0lBLUltMGh1SWVZQ3M1alRpZE1UMnFBPXczMDAnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoIWRhdGEuaXNUaW1lIHx8IGRhdGEuaXNUaW1lID09PSBcIm5vd1wiKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9ICc8ZGl2IHN0eWxlPVwid2lkdGg6JyArIGRhdGEud2lkdGggKyAnO2hlaWdodDonICsgZGF0YS5oZWlnaHQgKyAnO3RleHQtYWxpZ246Y2VudGVyO1wiPjxhIGhyZWY9XCJodHRwOi8vJyArIGRhdGEuaG9zdG5hbWUgKyBcIjpcIiArIGRhdGEuaHR0cF9wb3J0ICsgJy8nICsgaGxzYXBwICsgJy8nICsgZGF0YS5jaGFubmVsICsgJy5tM3U4XCI+PGltZyBzdHlsZT1cIm1heC13aWR0aDoxMjBweFwiIHNyYz1cIicgKyBkYXRhLmltZyArICdcIj48L2E+PC9kaXY+JztcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmlzVGltZSA9PT0gXCJwYXN0XCIpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gJzxkaXYgc3R5bGU9XCJ3aWR0aDonICsgZGF0YS53aWR0aCArICc7aGVpZ2h0OicgKyBkYXRhLmhlaWdodCArICc7dGV4dC1hbGlnbjpjZW50ZXI7XCI+PGEgaHJlZj1cImh0dHA6Ly8nICsgZGF0YS5ob3N0bmFtZSArIFwiOlwiICsgZGF0YS5odHRwX3BvcnQgKyAnLycgKyBobHNhcHAgKyAnLycgKyBkYXRhLmNoYW5uZWwgKyAnLm0zdThcIj48aW1nIHN0eWxlPVwibWF4LXdpZHRoOjEyMHB4XCIgc3JjPVwiJyArIGRhdGEuaW1nICsgJ1wiPjwvYT48L2Rpdj4nO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmlzVGltZSA9PT0gXCJmdXR1cmVcIikge1xuICAgICAgICAgICAgICAgIGNvZGUgPSAnPGRpdiBzdHlsZT1cIndpZHRoOicgKyBkYXRhLndpZHRoICsgJztoZWlnaHQ6JyArIGRhdGEuaGVpZ2h0ICsgJzt0ZXh0LWFsaWduOmNlbnRlcjtcIj48YSBocmVmPVwiaHR0cDovLycgKyBkYXRhLmhvc3RuYW1lICsgXCI6XCIgKyBkYXRhLmh0dHBfcG9ydCArICcvJyArIGhsc2FwcCArICcvJyArIGRhdGEuY2hhbm5lbCArICcubTN1OFwiPjxpbWcgc3R5bGU9XCJtYXgtd2lkdGg6MTIwcHhcIiBzcmM9XCInICsgZGF0YS5pbWcgKyAnXCI+PC9hPjwvZGl2Pic7XG5cbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBicmVhaztcblxuXG4gICAgICAgIGRlZmF1bHQ6XG5cbiAgICAgICAgICAgIGlmICghZGF0YS5ydG1wX3BvcnQpIGRhdGEucnRtcF9wb3J0ID0gMTkzNTtcblxuICAgICAgICAgICAgbGV0IGZsYXNocGxheWVyID0gXCJodHRwczovL3BsYXkua2VybmVsLm9ubGluZS9saWIvU3Ryb2JlTWVkaWFQbGF5YmFjay5zd2ZcIlxuICAgICAgICAgICAgaWYgKGRhdGEuZmxhc2hwbGF5ZXIpIGZsYXNocGxheWVyID0gZGF0YS5mbGFzaHBsYXllclxuXG5cbiAgICAgICAgICAgIGlmICghZGF0YS5pc1RpbWUgfHwgZGF0YS5pc1RpbWUgPT09IFwibm93XCIpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gJzxvYmplY3Qgd2lkdGg9XCInICsgZGF0YS53aWR0aCArICdcIiBoZWlnaHQ9XCInICsgZGF0YS5oZWlnaHQgKyAnXCI+IDxwYXJhbSBuYW1lPVwibW92aWVcIiB2YWx1ZT0nICsgZmxhc2hwbGF5ZXIgKyAnPjwvcGFyYW0+PHBhcmFtIG5hbWU9XCJmbGFzaHZhcnNcIiB2YWx1ZT1cInNyYz1ydG1wJTNBJTJGJTJGJyArIGRhdGEuaG9zdG5hbWUgKyAnJTNBJyArIGRhdGEucnRtcF9wb3J0ICsgJyUyRicgKyBtZWRpYXBwICsgJyUyRicgKyBkYXRhLmNoYW5uZWwgKyAnJnN0cmVhbVR5cGU9bGl2ZSZzY2FsZU1vZGU9em9vbVwiPjwvcGFyYW0+PHBhcmFtIG5hbWU9XCJhbGxvd0Z1bGxTY3JlZW5cIiB2YWx1ZT1cInRydWVcIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwiYWxsb3dzY3JpcHRhY2Nlc3NcIiB2YWx1ZT1cImFsd2F5c1wiPjwvcGFyYW0+PHBhcmFtIG5hbWU9XCJ3bW9kZVwiIHZhbHVlPVwiZGlyZWN0XCI+PC9wYXJhbT48ZW1iZWQgc3JjPScgKyBmbGFzaHBsYXllciArICcgdHlwZT1cImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoXCIgYWxsb3dzY3JpcHRhY2Nlc3M9XCJhbHdheXNcIiBhbGxvd2Z1bGxzY3JlZW49XCJ0cnVlXCIgd21vZGU9XCJkaXJlY3RcIiB3aWR0aD1cIicgKyBkYXRhLndpZHRoICsgJ1wiIGhlaWdodD1cIicgKyBkYXRhLmhlaWdodCArICdcIiBmbGFzaHZhcnM9XCJzcmM9cnRtcCUzQSUyRiUyRicgKyBkYXRhLmhvc3RuYW1lICsgJyUzQScgKyBkYXRhLnJ0bXBfcG9ydCArICclMkYnICsgbWVkaWFwcCArICclMkYnICsgZGF0YS5jaGFubmVsICsgJyZzdHJlYW1UeXBlPWxpdmUmc2NhbGVNb2RlPXpvb21cIj48L2VtYmVkPjwvb2JqZWN0PidcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmlzVGltZSA9PT0gXCJwYXN0XCIpIHtcbiAgICAgICAgICAgICAgICBjb2RlID0gJzxvYmplY3Qgd2lkdGg9XCInICsgZGF0YS53aWR0aCArICdcIiBoZWlnaHQ9XCInICsgZGF0YS5oZWlnaHQgKyAnXCI+IDxwYXJhbSBuYW1lPVwibW92aWVcIiB2YWx1ZT1cIicgKyBmbGFzaHBsYXllciArICdcIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwiZmxhc2h2YXJzXCIgdmFsdWU9XCJzcmM9cnRtcCUzQSUyRiUyRicgKyBkYXRhLmhvc3RuYW1lICsgJyUzQScgKyBkYXRhLnJ0bXBfcG9ydCArICclMkYnICsgbWVkaWFwcCArICclMkYnICsgZGF0YS5jaGFubmVsICsgJyZzdHJlYW1UeXBlPWxpdmUmc2NhbGVNb2RlPXpvb21cIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwiYWxsb3dGdWxsU2NyZWVuXCIgdmFsdWU9XCJ0cnVlXCI+PC9wYXJhbT48cGFyYW0gbmFtZT1cImFsbG93c2NyaXB0YWNjZXNzXCIgdmFsdWU9XCJhbHdheXNcIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwid21vZGVcIiB2YWx1ZT1cImRpcmVjdFwiPjwvcGFyYW0+PGVtYmVkIHNyYz1cIicgKyBmbGFzaHBsYXllciArICdcIiB0eXBlPVwiYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2hcIiBhbGxvd3NjcmlwdGFjY2Vzcz1cImFsd2F5c1wiIGFsbG93ZnVsbHNjcmVlbj1cInRydWVcIiB3bW9kZT1cImRpcmVjdFwiIHdpZHRoPVwiJyArIGRhdGEud2lkdGggKyAnXCIgaGVpZ2h0PVwiJyArIGRhdGEuaGVpZ2h0ICsgJ1wiIGZsYXNodmFycz1cInNyYz1ydG1wJTNBJTJGJTJGJyArIGRhdGEuaG9zdG5hbWUgKyAnJTNBJyArIGRhdGEucnRtcF9wb3J0ICsgJyUyRicgKyBtZWRpYXBwICsgJyUyRicgKyBkYXRhLmNoYW5uZWwgKyAnJnN0cmVhbVR5cGU9bGl2ZSZzY2FsZU1vZGU9em9vbVwiPjwvZW1iZWQ+PC9vYmplY3Q+J1xuICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmlzVGltZSA9PT0gXCJmdXR1cmVcIikge1xuICAgICAgICAgICAgICAgIGNvZGUgPSAnPG9iamVjdCB3aWR0aD1cIicgKyBkYXRhLndpZHRoICsgJ1wiIGhlaWdodD1cIicgKyBkYXRhLmhlaWdodCArICdcIj4gPHBhcmFtIG5hbWU9XCJtb3ZpZVwiIHZhbHVlPVwiJyArIGZsYXNocGxheWVyICsgJ1wiPjwvcGFyYW0+PHBhcmFtIG5hbWU9XCJmbGFzaHZhcnNcIiB2YWx1ZT1cInNyYz1ydG1wJTNBJTJGJTJGJyArIGRhdGEuaG9zdG5hbWUgKyAnJTNBJyArIGRhdGEucnRtcF9wb3J0ICsgJyUyRicgKyBtZWRpYXBwICsgJyUyRicgKyBkYXRhLmNoYW5uZWwgKyAnJnN0cmVhbVR5cGU9bGl2ZSZzY2FsZU1vZGU9em9vbVwiPjwvcGFyYW0+PHBhcmFtIG5hbWU9XCJhbGxvd0Z1bGxTY3JlZW5cIiB2YWx1ZT1cInRydWVcIj48L3BhcmFtPjxwYXJhbSBuYW1lPVwiYWxsb3dzY3JpcHRhY2Nlc3NcIiB2YWx1ZT1cImFsd2F5c1wiPjwvcGFyYW0+PHBhcmFtIG5hbWU9XCJ3bW9kZVwiIHZhbHVlPVwiZGlyZWN0XCI+PC9wYXJhbT48ZW1iZWQgc3JjPVwiJyArIGZsYXNocGxheWVyICsgJ1wiIHR5cGU9XCJhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaFwiIGFsbG93c2NyaXB0YWNjZXNzPVwiYWx3YXlzXCIgYWxsb3dmdWxsc2NyZWVuPVwidHJ1ZVwiIHdtb2RlPVwiZGlyZWN0XCIgd2lkdGg9XCInICsgZGF0YS53aWR0aCArICdcIiBoZWlnaHQ9XCInICsgZGF0YS5oZWlnaHQgKyAnXCIgZmxhc2h2YXJzPVwic3JjPXJ0bXAlM0ElMkYlMkYnICsgZGF0YS5ob3N0bmFtZSArICclM0EnICsgZGF0YS5ydG1wX3BvcnQgKyAnJTJGJyArIG1lZGlhcHAgKyAnJTJGJyArIGRhdGEuY2hhbm5lbCArICcmc3RyZWFtVHlwZT1saXZlJnNjYWxlTW9kZT16b29tXCI+PC9lbWJlZD48L29iamVjdD4nXG5cbiAgICAgICAgICAgIH1cblxuXG5cblxuXG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG5cbiAgICB9XG5cblxuICAgIHJldHVybiBjb2RlO1xuXG5cblxuXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNvZGVUb0h0bWwoY29kZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuICc8IURPQ1RZUEUgaHRtbD48aHRtbD48bWV0YSBjaGFyc2V0PVwidXRmLThcIj48aGVhZD48c3R5bGU+Ym9keXttYXJnaW46MHB4O3BhZGRpbmc6MHB4O292ZXJmbG93OmhpZGRlbn08L3N0eWxlPjwvaGVhZD48Ym9keT4nICsgY29kZSArICc8L2JvZHk+PC9odG1sPidcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEh0bWxQYWdlKGRhdGE6IEljb2RlU3RyZWFtKSB7XG4gICAgcmV0dXJuIGNvZGVUb0h0bWwoY29kZVN0cmVhbShkYXRhKSlcbn1cblxucm91dGVyLmdldCgnL2ZsYXNocGxheWVyJywgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gICAgcmVzLnNlbmRGaWxlKF9fZGlybmFtZSArIFwiL2Jpbi9TdHJvYmVNZWRpYVBsYXliYWNrLnN3ZlwiKVxufSk7XG5cblxuLy8gZGVmaW5lIHRoZSBob21lIHBhZ2Ugcm91dGVcbnJvdXRlci5nZXQoJy8nLCBmdW5jdGlvbiAocmVxLCByZXMpIHtcblxuXG5cbiAgICBpZiAocmVxLnF1ZXJ5LmNoYW5uZWwpIHtcblxuICAgICAgICBpZiAoIXJlcS5xdWVyeS5mbGFzaHBsYXllciAmJiBwcm9jZXNzLmVudi5TRVJWRVJIT1NUKSB7XG5cblxuICAgICAgICAgICAgcmVxLnF1ZXJ5LmZsYXNocGxheWVyID0gcHJvY2Vzcy5lbnYuU0VSVkVSSE9TVCArIFwiL2ZsYXNocGxheWVyXCJcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXEucXVlcnkuaG9zdG5hbWUpIHtcblxuXG4gICAgICAgICAgICByZXMuc2VuZChIdG1sUGFnZShyZXEucXVlcnkpKTtcbiAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzLmVudi5TVFJFQU1FUkhPU1QpIHtcblxuICAgICAgICAgICAgcmVxLnF1ZXJ5Lmhvc3RuYW1lID0gcHJvY2Vzcy5lbnYuU1RSRUFNRVJIT1NUXG5cbiAgICAgICAgICAgIGlmICghcmVxLnF1ZXJ5LnJ0bXBfcG9ydCAmJiBwcm9jZXNzLmVudi5TVFJFQU1FUl9SVE1QX1BPUlQpIHJlcS5xdWVyeS5ydG1wX3BvcnQgPSBwcm9jZXNzLmVudi5TVFJFQU1FUl9SVE1QX1BPUlRcbiAgICAgICAgICAgIGlmICghcmVxLnF1ZXJ5Lmh0dHBfcG9ydCAmJiBwcm9jZXNzLmVudi5TVFJFQU1FUl9IVFRQX1BPUlQpIHJlcS5xdWVyeS5odHRwX3BvcnQgPSBwcm9jZXNzLmVudi5TVFJFQU1FUl9IVFRQX1BPUlRcbiAgICAgICAgICAgIGlmICghcmVxLnF1ZXJ5LnByb3RvY29sICYmIHByb2Nlc3MuZW52LlNUUkVBTUVSX0hUVFBfUFJPVE9DT0wpIHJlcS5xdWVyeS5wcm90b2NvbCA9IHByb2Nlc3MuZW52LlNUUkVBTUVSX0hUVFBfUFJPVE9DT0xcblxuICAgICAgICAgICAgcmVzLnNlbmQoSHRtbFBhZ2UocmVxLnF1ZXJ5KSk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuXG4gICAgICAgICAgICByZXMuc2VuZCh7IGVycm9yOiBcIm5vIGhvc3QgcHJvdmlkZWRcIiB9KTtcblxuICAgICAgICB9XG5cblxuXG4gICAgfSBlbHNlIHtcblxuXG4gICAgICAgIHJlcy5zZW5kKHsgZXJyb3I6IFwibm8gY2hhbm5lbCBwcm92aWRlZFwiIH0pO1xuXG4gICAgfVxuXG5cbn0pO1xuXG5leHBvcnQgY29uc3QgaHRtbHBhZ2UgPSByb3V0ZXIiXX0=
